{% extends "base.html.j2" %}

{% block title %}{{ building.name or "建物詳細" }} | tatemono-map{% endblock %}

{% block header_meta %}
  <a class="muted" href="../index.html" aria-label="建物マップに戻る">← 建物マップに戻る</a>
{% endblock %}

{% block extra_head %}
<style>
  .stack {
    display: grid;
    gap: 14px;
  }

  .hero {
    padding: clamp(16px, 2.6vw, 24px);
  }

  .hero h1 {
    margin: 0;
    font-size: clamp(1.3rem, 2.8vw, 2rem);
    line-height: 1.3;
  }

  .hero p {
    margin: 8px 0 0;
    color: var(--muted);
  }

  .hero .cta-row {
    margin-top: 14px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }

  .hero .button {
    min-height: 46px;
    font-size: 1rem;
  }

  .info {
    padding: clamp(14px, 2.4vw, 20px);
  }

  .info h2 {
    margin: 0 0 10px;
    font-size: 1.08rem;
  }

  .facts {
    margin: 0;
    display: grid;
    gap: 8px;
  }

  .fact {
    margin: 0;
    display: grid;
    grid-template-columns: 140px minmax(0, 1fr);
    gap: 10px;
    border-top: 1px dashed var(--border);
    padding-top: 8px;
  }

  .fact:first-child {
    border-top: 0;
    padding-top: 0;
  }

  .fact dt {
    color: var(--muted);
    font-weight: 600;
  }

  .fact dd {
    margin: 0;
    font-weight: 700;
    color: #0f172a;
    line-height: 1.5;
  }

  .line-cta {
    padding: clamp(16px, 2.6vw, 24px);
    display: grid;
    gap: 10px;
    background: linear-gradient(145deg, #ecfeff 0%, #ecfdf5 100%);
    border: 1px solid #bbf7d0;
    border-radius: var(--radius);
  }

  .line-cta h2 {
    margin: 0;
    font-size: 1.08rem;
  }

  .line-cta p {
    margin: 0;
    color: #0f172a;
  }

  .line-cta ul {
    margin: 0;
    padding-left: 18px;
    color: #166534;
  }

  @media (max-width: 740px) {
    .fact {
      grid-template-columns: 1fr;
      gap: 4px;
    }

    .hero .cta-row {
      flex-direction: column;
      align-items: stretch;
    }

    .hero .button {
      width: 100%;
    }
  }
</style>
{% endblock %}

{% block content %}
  <div class="stack">
    <section class="hero card" aria-label="建物概要">
      <h1>{{ building.name or "名称未設定" }}</h1>
      <p>{{ building.address or "住所情報なし" }}</p>

      <ul class="kpis" aria-label="注目情報">
        <li class="kpi"><span>空室</span>{{ building.vacancy_count if building.vacancy_count is not none else "—" }}件</li>
        <li class="kpi"><span>家賃</span>{{ building.rent_yen_min|yen }}円 〜 {{ building.rent_yen_max|yen }}円</li>
        <li class="kpi"><span>面積</span>{{ (building.area_sqm_min ~ '㎡') if building.area_sqm_min is not none else '—' }} 〜 {{ (building.area_sqm_max ~ '㎡') if building.area_sqm_max is not none else '—' }}</li>
      </ul>

      <div class="cta-row">
        {% if maps_url %}
          <a class="button button--primary" href="{{ maps_url }}" target="_blank" rel="noopener">Googleマップを開く</a>
        {% endif %}
        <a class="button" href="../index.html" style="background:#e2e8f0; color:#0f172a;">建物マップへ戻る</a>
      </div>
    </section>

    <section class="info card" aria-label="詳細情報">
      <h2>募集情報</h2>
      <dl class="facts">
        <div class="fact">
          <dt>空室数</dt>
          <dd>{{ building.vacancy_count if building.vacancy_count is not none else "—" }}件</dd>
        </div>
        <div class="fact">
          <dt>家賃レンジ</dt>
          <dd>{{ building.rent_yen_min|yen }}円 〜 {{ building.rent_yen_max|yen }}円</dd>
        </div>
        <div class="fact">
          <dt>面積レンジ</dt>
          <dd>{{ (building.area_sqm_min ~ '㎡') if building.area_sqm_min is not none else '—' }} 〜 {{ (building.area_sqm_max ~ '㎡') if building.area_sqm_max is not none else '—' }}</dd>
        </div>
        <div class="fact">
          <dt>間取りタイプ</dt>
          <dd>{{ building.layout_types | join(', ') if building.layout_types else '—' }}</dd>
        </div>
        <div class="fact">
          <dt>入居可能日</dt>
          <dd>{{ building.move_in_dates | join(', ') if building.move_in_dates else '—' }}</dd>
        </div>
        <div class="fact">
          <dt>空室データ取得日</dt>
          <dd>{{ building.last_updated or '—' }}</dd>
        </div>
      </dl>
    </section>

    <section class="line-cta" aria-label="LINEで問い合わせる">
      <h2>最新の空室情報をLINEで受け取る</h2>
      <p>希望条件を送ると、条件に近い募集情報をまとめて確認できます。</p>
      <ul>
        <li>「沿線・駅」「家賃」「広さ」などをまとめて共有</li>
        <li>気になる建物名を送って提案を受ける</li>
      </ul>
      <div>
        {% if line_cta_url %}
          <a class="button button--line" href="{{ line_cta_url }}" target="_blank" rel="noopener">LINEで条件を送る</a>
        {% else %}
          <button class="button button--line" type="button" disabled>LINEで条件を送る</button>
        {% endif %}
      </div>
    </section>
  </div>
{% endblock %}
